<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
  <title>Starter Template - Materialize</title>

  <!-- CSS  -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Raleway" />
  <link href="css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link href="css/style.css" type="text/css" rel="stylesheet" media="screen,projection"/>
</head>
<body>
  <!-- <nav class="light-blue lighten-1" role="navigation">
    <div class="nav-wrapper"><a id="logo-container" href="#" class="brand-logo">Logo</a>
      
     
    </div>
  </nav> -->
  <!-- <div class="section no-pad-bot no-pad-top" >
    <div class="container">
      <div class="nav-wrapper">
          <a href="#!" class="brand-logo">Logo</a>
      </div>

    </div>
    <div class="progress">
        <div class="determinate" style="width: 70%"></div>
    </div>
  </div> -->
  <div id="main">
      <nav class="white-nav no-shadow">
          <div class="nav-wrapper center-align">
              <a href="account.html" class="sidenav-back nav-back" ><i class="material-icons bold">arrow_back</i></a>
            <a class="nav-title"></a>
            
          </div>
          
        </nav>
    
    
      <div class="container">
        <div class="section">
            <span class="vc_bar " data-percentage-value="80" data-value="80" style="background-color: rgb(239, 72, 54); width: 80%;"></span>
          <!--   Icon Section   -->
          <div class="row">
              
              <div class="col s12 m7">
                  <div class="userinfo-top-menu">
                    <div class="title bold">비밀번호 변경</div>

                  </div>
              </div>

              <form class="col s12" autocomplete="off">
                  <div class="row no-mar-bot">
                      <div class="input-field col s12">
                        <input placeholder="특수문자를 포함하여 6자 이상 10자 이하로 입력해주세요" id="password" type="password" class="validate" >
                        <label for="password">새 비밀번호</label>
                        <span class="helper-text" data-error="특수문자를 포함하여 6자 이상 10자 이하로 입력해주세요" data-success=""></span>
                      </div>
                    </div>
  
                    <div class="row no-mar-bot">
                      <div class="input-field col s12">
                        <input placeholder="비밀번호를 확인해주세요" id="passwordConfirm" type="password" class="validate">
                        <label for="passwordConfirm">새 비밀번호 확인</label>
                        <span class="helper-text" data-error="비밀번호가 일치하지 않습니다." data-success=""></span>
                      </div>
                    </div>
                
              </form>
          </div>
    
        </div>
      </div>

      <footer id="complete-button" class="footer-button">
          <a id="btnChangePassword" class="waves-effect waves-light btn-large bold round-blue-btn inactive" href="#">확인</a>
      </footer>
  </div>
  

 





  <!--  Scripts-->
  <script src="js/jquery-2.1.1.min.js"></script>
  <script src="js/materialize.js"></script>
  <script src="js/init.js"></script>
  <script src="js/manager.js"></script>


  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/6.3.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/6.3.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/6.3.1/firebase-database.js"></script>

  <!-- TODO: Add SDKs for Firebase products that you want to use
      https://firebase.google.com/docs/web/setup#config-web-app -->

  <script>
    // Your web app's Firebase configuration
    var firebaseConfig = {
      apiKey: "AIzaSyDyKMGQN_j2SvrOcoefmx7O2OfAfiszEPE",
      authDomain: "yonsei2019-d11b7.firebaseapp.com",
      databaseURL: "https://yonsei2019-d11b7.firebaseio.com",
      projectId: "yonsei2019-d11b7",
      storageBucket: "",
      messagingSenderId: "1067485696875",
      appId: "1:1067485696875:web:77d94c991b4b02d8"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    var elem = document.querySelector('.collapsible.expandable');
    var instance = M.Collapsible.init(elem, {
      accordion: false
    });

    var passwordRegex = /(?=.*\d{1,50})(?=.*[~`!@#$%\^&*()-+=]{1,50})(?=.*[a-zA-Z]{2,50}).{6,10}$/g;

    $(document).ready(function(){
      $('.modal').modal();

      // $("#password").on("focusout", function (e) {
   
      //   console.log($(this).val());
      //   if(!passwordRegex.test($(this).val())) {
      //     $("#password").removeClass("valid").addClass("invalid");
      //   }
      //   else  if ($(this).val() != $("#passwordConfirm").val()) {
      //     $("#passwordConfirm").removeClass("valid").addClass("invalid");
      //   } 
      //   else {
      //     $("#passwordConfirm").removeClass("invalid").addClass("valid");
      //   }
      // });

      $("#password").on("blur", function (e) {
        console.log($(this).val());
        if(!passwordRegex.test($(this).val())) {
          console.log("regex");
          $("#password").removeClass("valid").addClass("invalid");
        }
        else if ($(this).val() != $("#passwordConfirm").val()) {
          $("#passwordConfirm").removeClass("valid").addClass("invalid");
        } 
        else {
          $("#passwordConfirm").removeClass("invalid").addClass("valid");
        }
      });

      $("#passwordConfirm").on("keyup", function (e) {
        if ($("#password").val() != $(this).val()) {
          $(this).removeClass("valid").addClass("invalid");
        } else {
          $(this).removeClass("invalid").addClass("valid");
        }
      });

      $("#passwordConfirm").on("focusout", function (e) {
        if ($("#password").val() != $(this).val()) {
          $(this).removeClass("valid").addClass("invalid");
        } else {
          $(this).removeClass("invalid").addClass("valid");
        }
      });

      $("input.validate").on("keyup",function() {
        if($(".validate.valid").length == 2) {
          $(".round-blue-btn").removeClass('inactive');
        }
        else {
          if($(".round-blue-btn").hasClass('inactive') == false) {
            $(".round-blue-btn").addClass('inactive');
          }
        }
      });

      $(".nav-back").on('click', function() {
        location.href="account.html";
      });

      $("#btnChangePassword").on('click',function() {
        if($(this).hasClass('inactive')) {

        } else {
          if( $("#password").val() == $("#passwordConfirm").val() ) {
            var user = firebase.auth().currentUser;
            var newPassword = $("#password").val();
            user.updatePassword(newPassword).then(() => {
              location.href="account.html?process=change";
            }, (error) => {
              // An error happened.
            });
          } else {
          }
        } 
      });

    });
  </script>

  </body>
</html>
