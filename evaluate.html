<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
  <title>Starter Template - Materialize</title>

  <!-- CSS  -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Raleway" />
  <link href="css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link href="css/style.css" type="text/css" rel="stylesheet" media="screen,projection"/>
</head>
<body id="evaluate-body">
  <!-- <nav class="light-blue lighten-1" role="navigation">
    <div class="nav-wrapper"><a id="logo-container" href="#" class="brand-logo">Logo</a>
      
     
    </div>
  </nav> -->
  <!-- <div class="section no-pad-bot no-pad-top" >
    <div class="container">
      <div class="nav-wrapper">
          <a href="#!" class="brand-logo">Logo</a>
      </div>

    </div>
    <div class="progress">
        <div class="determinate" style="width: 70%"></div>
    </div>
  </div> -->
  <div id="main">
      <nav class="fixed-nav white-nav">
          <div class="nav-wrapper center-align">
            <a class="nav-title">차세대 이동공간 콘텐츠 <span class="raleway">UX</span>평가</a>
            <a href="#modalClose"  class="sidenav-close modal-trigger-custom" ><i class="material-icons bold">close</i></a>

          </div>
          <div class="progress no-mar-top">
              <div class="determinate" style="width: 0%"></div>
          </div>
        </nav>
    
    
      <div class="evaluate-wrap">
        <div class="section">
          <!--   Icon Section   -->
          <div class="row">
              
              <div id="cardList" class="col s12 m7">
                     

    
              </div>
          </div>
    
        </div>
      </div>
  </div>
  

  <footer id="complete-button" class=" hide">
    <div class="footer-btn-fixed">
        <a id="btnEvaluateComplete" class="waves-effect waves-light btn-large evaluate-btn bold">평가 완료</a>
    </div>
    <div class="no-login">비로그인 상태에서는 최근 평가 기록만 저장됩니다.</div>
  </footer>

  <div id="loading" class="preloading width100 valign-wrapper">
      <div class="preloader-wrapper active">
          <div class="spinner-layer spinner-blue-only">
            <div class="circle-clipper left">
              <div class="circle"></div>
            </div><div class="gap-patch">
              <div class="circle"></div>
            </div><div class="circle-clipper right">
              <div class="circle"></div>
            </div>
          </div>
        </div>
  </div>

  <div id="cardTemplate" class="hide">
      <div class="card-wrap">
        <div class="card horizontal custom" data-num='72'>
          <div class="card-stacked">
            <div class="card-content">
                <div class="evaluate-num">
                  <img class="check" src="img/check.png">
                </div>
              <p>헤드마운트디스플레이 기반의 VR 3D 영상 콘텐츠 제작 시, 지오메트리 에러(ex. 수직 불일치, 기울임 불일치, 스케일 불일치 등)가 발생하지 않는가?</p>
            </div>
          </div>
          <span class="helper">
            <span class="helper-text">설명 숨기기</span>
            <img src="img/question_info_off.png">
          </span>
        </div>

        <div class="helper-description">
          <p>
            텍스트 텍스트 텍스트 텍스트 텍스트 텍스트 텍스트 텍스트 텍스트 텍스트
            텍스트 텍스트 텍스트 텍스트 텍스트 텍스트 텍스트 텍스트 텍스트 텍스트
            텍스트 텍스트 텍스트 텍스트 텍스트 텍스트 텍스트 텍스트
          </p>
        </div>
      </div>
  </div>

  <div class="modal-overlay" style="z-index: 1002; display: none; opacity: 0.5;"></div>
  <!-- Modal Structure -->
  <div id="modalClose" class="modal custom">
    <div class="modal-content">
      <h5>평가를 중단하시겠습니까?</h5>
      <p class="modal-description">
        중단한 평가는 이후에 이어서 평가가 가능합니다.
      </p>
    </div>
    <div class="modal-footer">

      <a class="btn-large evaluate-btn modal-positive modal-close" >평가 재개</a>
      <a id="btnStopEvaluate" class="modal-negative modal-close">평가 중단</a>
    </div>
  </div>


  <!--  Scripts-->
  <script src="js/jquery-2.1.1.min.js"></script>
  <script src="js/materialize.js"></script>
  <script src="js/init.js"></script>
 

  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/6.3.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/6.3.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/6.3.1/firebase-database.js"></script>
  <script src="js/manager.js"></script>

  <!-- TODO: Add SDKs for Firebase products that you want to use
      https://firebase.google.com/docs/web/setup#config-web-app -->

  <script>
    // Your web app's Firebase configuration
    var firebaseConfig = {
      apiKey: "AIzaSyDyKMGQN_j2SvrOcoefmx7O2OfAfiszEPE",
      authDomain: "yonsei2019-d11b7.firebaseapp.com",
      databaseURL: "https://yonsei2019-d11b7.firebaseio.com",
      projectId: "yonsei2019-d11b7",
      storageBucket: "",
      messagingSenderId: "1067485696875",
      appId: "1:1067485696875:web:77d94c991b4b02d8"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    var elem = document.querySelector('.collapsible.expandable');
    var instance = M.Collapsible.init(elem, {
      accordion: false
    });

    jQuery.fn.justtext = function() {
      return $(this).clone()
          .children()
          .remove()
          .end()
          .text().trim();
    };


    if(sessionStorage.getItem('uid')!=null) {
      var userId = sessionStorage.getItem('uid');
      $(".no-login").hide();
      $(".footer-btn-fixed").css("bottom", '0vh');
    } else {
      $(".no-login").show();
      $(".footer-btn-fixed").css("bottom", '3vh');
    }

    // (function onInit() {
    //   sendInit();
      
    // })();


    $(document).ready(function(){
      $('.modal').modal();
      
      sendInit();

      var Params = getUrlParams();
      if(Params.process && localStorage.getItem('resulting') != null) {

        //getQuestion();

        getQuestion(function() {
          var resulting = localStorage.getItem('resulting').split(',');
          console.log(resulting);
          var lastObj = resulting[resulting.length-1];
          $(".card.custom").each(function() { 
            if($.inArray($(this).data('num').toString(), resulting) != -1){
              $(this).addClass('selected');
            }
          });

          var offset = $(".card.selected[data-num=" + lastObj + "]").offset();
          $('html, body').animate({scrollTop : offset.top}, 500);


          localStorage.removeItem('resulting');
        });
      } else {
        getQuestion();
      }


      $("#cardList").on('click','.helper img', function(e) {
          e.preventDefault();
          var basic = 'img/question_info_off.png'
          var close = 'img/icons/question_info_on.svg';
          $(this).parent().toggleClass("active");
          $(this).attr("src",  ($(this).attr("src")==basic? close : basic));
          $(this).closest("div.card").next('div.helper-description').slideToggle();
          e.stopPropagation()
      });

      $("#cardList").on('click', '.card.custom' ,function(e) {
          e.preventDefault();
          $(this).toggleClass("selected");
      });

      document.addEventListener('scroll', function() {
        //var currentPercent = (window.scrollY) / $(".evaluate-wrap").height() * 100;
        var currentPercent = $(window).scrollTop() / ($(document).height() - $(window).height()) * 100

        currentPercent = parseInt(currentPercent);
        $(".determinate").css("width",currentPercent+"%");
        
        if(currentPercent > 95) {
          $("#complete-button").removeClass('hide');
        }
        else {
          $("#complete-button").addClass('hide');
        }
      });

     
      $("#btnStopEvaluate").click(function() {
        storeToStorage();

        //localStorage.removeItem('selections');
        location.href="index.html";      
      });

      $("#btnEvaluateComplete").click(function() {
        //storeToStorage();
        generateModulePoints();
              
      });
    });


    function storeToStorage() {
      var ResultIng = [];
      $(".card.custom.selected").each(function() { 
        ResultIng.push($(this).data('num'));
      });
      if(ResultIng.length > 0)
        localStorage.setItem('resulting',ResultIng);
    }
  </script>

  </body>
</html>
